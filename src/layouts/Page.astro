---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';

const { title, description } = Astro.props;
---

<html lang="zh-CN">
	<head>
		<BaseHead title={title} description={description} />
		<style>
			main {
				width: calc(100% - 2em);
				max-width: 100%;
				margin: 0;
			}
			.prose {
				width: 720px;
				max-width: calc(100% - 2em);
				margin: auto;
				padding: 1em;
				color: rgb(var(--gray-dark));
			}
			.title {
				margin-bottom: 1em;
				padding: 1em 0;
				text-align: center;
				line-height: 1;
			}
			.title h1 {
				margin: 0 0 0.5em 0;
			}
		</style>
	</head>

	<body>
		<Header />
		<main>
			<article>
				<div class="prose">
					<div class="title">
						<h1>{title}</h1>
						<hr />
					</div>
					<slot />
				</div>
			</article>
		</main>
		<Footer />
		
		<!-- Mermaid图表初始化 -->
		<script src="https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js"></script>
		<script>
			// 等待mermaid加载完成
			document.addEventListener('DOMContentLoaded', () => {
				// 检查mermaid是否已加载
				if (typeof window.mermaid === 'undefined') {
					console.warn('Mermaid not loaded, retrying in 500ms');
					setTimeout(initMermaid, 500);
					return;
				}
				initMermaid();
			});

			function initMermaid() {
				// 初始化Mermaid配置
				window.mermaid.initialize({
					startOnLoad: true,
					theme: 'default',
					themeVariables: {
						primaryColor: '#2337ff',
						primaryTextColor: '#fff',
						primaryBorderColor: '#000d8a',
						lineColor: '#2337ff',
						secondaryColor: '#000d8a',
						tertiaryColor: '#f1f5f9',
						tertiaryBorderColor: '#e2e8f0',
						fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',
						fontSize: '14px'
					},
					flowchart: {
						curve: 'basis',
						htmlLabels: true,
						useMaxWidth: true,
						padding: 15
					},
					sequence: {
						diagramMarginX: 50,
						diagramMarginY: 10,
						actorMargin: 50,
						boxMargin: 10,
						messageMargin: 35,
						width: 150
					},
					gantt: {
						titleTopMargin: 25,
						barHeight: 20,
						barGap: 4,
						topPadding: 50,
						leftPadding: 75,
						gridLineStartPadding: 35,
						fontSize: 13,
						fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',
						numberSectionStyles: 4,
						axisFormat: '%Y-%m-%d'
					},
					securityLevel: 'loose'
				});

				// 监听主题变化
				const observer = new MutationObserver((mutations) => {
					mutations.forEach((mutation) => {
						if (mutation.attributeName === 'data-theme') {
							// 重新渲染Mermaid图表以适应主题变化
							window.mermaid.init(undefined, '.mermaid');
						}
					});
				});

				// 开始观察body元素的属性变化
				observer.observe(document.body, { attributes: true });
			}
		</script>
	</body>
</html>